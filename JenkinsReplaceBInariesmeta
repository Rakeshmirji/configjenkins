import groovy.json.JsonSlurper

pipeline {
    agent { node 'Apppxenwin10Agent_10.109.201.142' }

    parameters {
        string(name: 'BRANCH_NAME', defaultValue: 'main', description: 'Branch name to build')
        string(name: 'ENVIRONMENT', defaultValue: 'dev', description: 'Environment to deploy to')
        text(name: 'APP_CONFIG', defaultValue: '''{
            "Paint": {
                "Name": "Paint-Common"
            },
            "Notepad": {
                "Name": "Notepad-TSVDA-AppP"
            },
            "Calculator": {
                "Name": "Calculator-TSVDA-AppP"
            },
            "Desktop1": {
                "Name": "TSVDA-Common"
            },
            "Desktop2": {
                "Name": "TSVDA-AppP"
            },
            "Desktop3": {
                "Name": "Calculator-TSVDA-AppP"
            },
            "Desktop4": {
                "Name": "Calculator-TSVDA-AppP"
            }
        }''', description: 'App config')
    }

    stages {
        stage('Build') {
            steps {
                sh "echo Building branch ${params.BRANCH_NAME}..."
                script {
                    def appConfig = new JsonSlurper().parseText(params.APP_CONFIG)
                    // Use the appConfig variable as needed
                    sh "echo ${appConfig.Desktop4.Name} > app_config.json"
                }
            }
        }
        stage('Test') {
            steps {
                sh "echo Testing branch ${params.BRANCH_NAME} in ${params.ENVIRONMENT} environment..."
            }
        }
        stage('Deploy') {
            steps {
                sh "echo Deploying to ${params.ENVIRONMENT} environment..."
            }
        }
    }
}